{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nimport { toHex } from \"@aws-sdk/util-hex-encoding\";\nimport { ALGORITHM_IDENTIFIER, ALGORITHM_QUERY_PARAM, AMZ_DATE_HEADER, AMZ_DATE_QUERY_PARAM, AUTH_HEADER, CREDENTIAL_QUERY_PARAM, EVENT_ALGORITHM_IDENTIFIER, EXPIRES_QUERY_PARAM, MAX_PRESIGNED_TTL, SHA256_HEADER, SIGNATURE_QUERY_PARAM, SIGNED_HEADERS_QUERY_PARAM, TOKEN_HEADER, TOKEN_QUERY_PARAM } from \"./constants\";\nimport { createScope, getSigningKey } from \"./credentialDerivation\";\nimport { getCanonicalHeaders } from \"./getCanonicalHeaders\";\nimport { getCanonicalQuery } from \"./getCanonicalQuery\";\nimport { getPayloadHash } from \"./getPayloadHash\";\nimport { hasHeader } from \"./headerUtil\";\nimport { moveHeadersToQuery } from \"./moveHeadersToQuery\";\nimport { normalizeCredentialsProvider, normalizeRegionProvider } from \"./normalizeProvider\";\nimport { prepareRequest } from \"./prepareRequest\";\nimport { iso8601 } from \"./utilDate\";\n\nvar SignatureV4 = function () {\n  function SignatureV4(_a) {\n    var applyChecksum = _a.applyChecksum,\n        credentials = _a.credentials,\n        region = _a.region,\n        service = _a.service,\n        sha256 = _a.sha256,\n        _b = _a.uriEscapePath,\n        uriEscapePath = _b === void 0 ? true : _b;\n    this.service = service;\n    this.sha256 = sha256;\n    this.uriEscapePath = uriEscapePath;\n    this.applyChecksum = typeof applyChecksum === \"boolean\" ? applyChecksum : true;\n    this.regionProvider = normalizeRegionProvider(region);\n    this.credentialProvider = normalizeCredentialsProvider(credentials);\n  }\n\n  SignatureV4.prototype.presign = function (originalRequest, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, signingDate, _b, expiresIn, unsignableHeaders, unhoistableHeaders, signableHeaders, signingRegion, signingService, credentials, region, _c, _d, longDate, shortDate, scope, request, canonicalHeaders, _e, _f, _g, _h, _j, _k;\n\n      return __generator(this, function (_l) {\n        switch (_l.label) {\n          case 0:\n            _a = options.signingDate, signingDate = _a === void 0 ? new Date() : _a, _b = options.expiresIn, expiresIn = _b === void 0 ? 3600 : _b, unsignableHeaders = options.unsignableHeaders, unhoistableHeaders = options.unhoistableHeaders, signableHeaders = options.signableHeaders, signingRegion = options.signingRegion, signingService = options.signingService;\n            return [4, this.credentialProvider()];\n\n          case 1:\n            credentials = _l.sent();\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n            _c = signingRegion;\n            return [3, 4];\n\n          case 2:\n            return [4, this.regionProvider()];\n\n          case 3:\n            _c = _l.sent();\n            _l.label = 4;\n\n          case 4:\n            region = _c;\n            _d = formatDate(signingDate), longDate = _d.longDate, shortDate = _d.shortDate;\n\n            if (expiresIn > MAX_PRESIGNED_TTL) {\n              return [2, Promise.reject(\"Signature version 4 presigned URLs\" + \" must have an expiration date less than one week in\" + \" the future\")];\n            }\n\n            scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n            request = moveHeadersToQuery(prepareRequest(originalRequest), {\n              unhoistableHeaders: unhoistableHeaders\n            });\n\n            if (credentials.sessionToken) {\n              request.query[TOKEN_QUERY_PARAM] = credentials.sessionToken;\n            }\n\n            request.query[ALGORITHM_QUERY_PARAM] = ALGORITHM_IDENTIFIER;\n            request.query[CREDENTIAL_QUERY_PARAM] = credentials.accessKeyId + \"/\" + scope;\n            request.query[AMZ_DATE_QUERY_PARAM] = longDate;\n            request.query[EXPIRES_QUERY_PARAM] = expiresIn.toString(10);\n            canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n            request.query[SIGNED_HEADERS_QUERY_PARAM] = getCanonicalHeaderList(canonicalHeaders);\n            _e = request.query;\n            _f = SIGNATURE_QUERY_PARAM;\n            _g = this.getSignature;\n            _h = [longDate, scope, this.getSigningKey(credentials, region, shortDate, signingService)];\n            _j = this.createCanonicalRequest;\n            _k = [request, canonicalHeaders];\n            return [4, getPayloadHash(originalRequest, this.sha256)];\n\n          case 5:\n            return [4, _g.apply(this, _h.concat([_j.apply(this, _k.concat([_l.sent()]))]))];\n\n          case 6:\n            _e[_f] = _l.sent();\n            return [2, request];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.sign = function (toSign, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (typeof toSign === \"string\") {\n          return [2, this.signString(toSign, options)];\n        } else if (toSign.headers && toSign.payload) {\n          return [2, this.signEvent(toSign, options)];\n        } else {\n          return [2, this.signRequest(toSign, options)];\n        }\n\n        return [2];\n      });\n    });\n  };\n\n  SignatureV4.prototype.signEvent = function (_a, _b) {\n    var headers = _a.headers,\n        payload = _a.payload;\n    var _c = _b.signingDate,\n        signingDate = _c === void 0 ? new Date() : _c,\n        priorSignature = _b.priorSignature,\n        signingRegion = _b.signingRegion,\n        signingService = _b.signingService;\n    return __awaiter(this, void 0, void 0, function () {\n      var region, _d, _e, shortDate, longDate, scope, hashedPayload, hash, hashedHeaders, _f, stringToSign;\n\n      return __generator(this, function (_g) {\n        switch (_g.label) {\n          case 0:\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 1];\n            _d = signingRegion;\n            return [3, 3];\n\n          case 1:\n            return [4, this.regionProvider()];\n\n          case 2:\n            _d = _g.sent();\n            _g.label = 3;\n\n          case 3:\n            region = _d;\n            _e = formatDate(signingDate), shortDate = _e.shortDate, longDate = _e.longDate;\n            scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n            return [4, getPayloadHash({\n              headers: {},\n              body: payload\n            }, this.sha256)];\n\n          case 4:\n            hashedPayload = _g.sent();\n            hash = new this.sha256();\n            hash.update(headers);\n            _f = toHex;\n            return [4, hash.digest()];\n\n          case 5:\n            hashedHeaders = _f.apply(void 0, [_g.sent()]);\n            stringToSign = [EVENT_ALGORITHM_IDENTIFIER, longDate, scope, priorSignature, hashedHeaders, hashedPayload].join(\"\\n\");\n            return [2, this.signString(stringToSign, {\n              signingDate: signingDate,\n              signingRegion: region,\n              signingService: signingService\n            })];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.signString = function (stringToSign, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.signingDate,\n        signingDate = _c === void 0 ? new Date() : _c,\n        signingRegion = _b.signingRegion,\n        signingService = _b.signingService;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var credentials, region, _d, shortDate, hash, _e, _f, _g;\n\n      return __generator(this, function (_h) {\n        switch (_h.label) {\n          case 0:\n            return [4, this.credentialProvider()];\n\n          case 1:\n            credentials = _h.sent();\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n            _d = signingRegion;\n            return [3, 4];\n\n          case 2:\n            return [4, this.regionProvider()];\n\n          case 3:\n            _d = _h.sent();\n            _h.label = 4;\n\n          case 4:\n            region = _d;\n            shortDate = formatDate(signingDate).shortDate;\n            _f = (_e = this.sha256).bind;\n            return [4, this.getSigningKey(credentials, region, shortDate, signingService)];\n\n          case 5:\n            hash = new (_f.apply(_e, [void 0, _h.sent()]))();\n            hash.update(stringToSign);\n            _g = toHex;\n            return [4, hash.digest()];\n\n          case 6:\n            return [2, _g.apply(void 0, [_h.sent()])];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.signRequest = function (requestToSign, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.signingDate,\n        signingDate = _c === void 0 ? new Date() : _c,\n        signableHeaders = _b.signableHeaders,\n        unsignableHeaders = _b.unsignableHeaders,\n        signingRegion = _b.signingRegion,\n        signingService = _b.signingService;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var credentials, region, _d, request, _e, longDate, shortDate, scope, payloadHash, canonicalHeaders, signature;\n\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            return [4, this.credentialProvider()];\n\n          case 1:\n            credentials = _f.sent();\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n            _d = signingRegion;\n            return [3, 4];\n\n          case 2:\n            return [4, this.regionProvider()];\n\n          case 3:\n            _d = _f.sent();\n            _f.label = 4;\n\n          case 4:\n            region = _d;\n            request = prepareRequest(requestToSign);\n            _e = formatDate(signingDate), longDate = _e.longDate, shortDate = _e.shortDate;\n            scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n            request.headers[AMZ_DATE_HEADER] = longDate;\n\n            if (credentials.sessionToken) {\n              request.headers[TOKEN_HEADER] = credentials.sessionToken;\n            }\n\n            return [4, getPayloadHash(request, this.sha256)];\n\n          case 5:\n            payloadHash = _f.sent();\n\n            if (!hasHeader(SHA256_HEADER, request.headers) && this.applyChecksum) {\n              request.headers[SHA256_HEADER] = payloadHash;\n            }\n\n            canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n            return [4, this.getSignature(longDate, scope, this.getSigningKey(credentials, region, shortDate, signingService), this.createCanonicalRequest(request, canonicalHeaders, payloadHash))];\n\n          case 6:\n            signature = _f.sent();\n            request.headers[AUTH_HEADER] = ALGORITHM_IDENTIFIER + \" \" + (\"Credential=\" + credentials.accessKeyId + \"/\" + scope + \", \") + (\"SignedHeaders=\" + getCanonicalHeaderList(canonicalHeaders) + \", \") + (\"Signature=\" + signature);\n            return [2, request];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.createCanonicalRequest = function (request, canonicalHeaders, payloadHash) {\n    var sortedHeaders = Object.keys(canonicalHeaders).sort();\n    return request.method + \"\\n\" + this.getCanonicalPath(request) + \"\\n\" + getCanonicalQuery(request) + \"\\n\" + sortedHeaders.map(function (name) {\n      return name + \":\" + canonicalHeaders[name];\n    }).join(\"\\n\") + \"\\n\\n\" + sortedHeaders.join(\";\") + \"\\n\" + payloadHash;\n  };\n\n  SignatureV4.prototype.createStringToSign = function (longDate, credentialScope, canonicalRequest) {\n    return __awaiter(this, void 0, void 0, function () {\n      var hash, hashedRequest;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            hash = new this.sha256();\n            hash.update(canonicalRequest);\n            return [4, hash.digest()];\n\n          case 1:\n            hashedRequest = _a.sent();\n            return [2, ALGORITHM_IDENTIFIER + \"\\n\" + longDate + \"\\n\" + credentialScope + \"\\n\" + toHex(hashedRequest)];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.getCanonicalPath = function (_a) {\n    var path = _a.path;\n\n    if (this.uriEscapePath) {\n      var doubleEncoded = encodeURIComponent(path.replace(/^\\//, \"\"));\n      return \"/\" + doubleEncoded.replace(/%2F/g, \"/\");\n    }\n\n    return path;\n  };\n\n  SignatureV4.prototype.getSignature = function (longDate, credentialScope, keyPromise, canonicalRequest) {\n    return __awaiter(this, void 0, void 0, function () {\n      var stringToSign, hash, _a, _b, _c;\n\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            return [4, this.createStringToSign(longDate, credentialScope, canonicalRequest)];\n\n          case 1:\n            stringToSign = _d.sent();\n            _b = (_a = this.sha256).bind;\n            return [4, keyPromise];\n\n          case 2:\n            hash = new (_b.apply(_a, [void 0, _d.sent()]))();\n            hash.update(stringToSign);\n            _c = toHex;\n            return [4, hash.digest()];\n\n          case 3:\n            return [2, _c.apply(void 0, [_d.sent()])];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.getSigningKey = function (credentials, region, shortDate, service) {\n    return getSigningKey(this.sha256, credentials, shortDate, region, service || this.service);\n  };\n\n  return SignatureV4;\n}();\n\nexport { SignatureV4 };\n\nvar formatDate = function formatDate(now) {\n  var longDate = iso8601(now).replace(/[\\-:]/g, \"\");\n  return {\n    longDate: longDate,\n    shortDate: longDate.substr(0, 8)\n  };\n};\n\nvar getCanonicalHeaderList = function getCanonicalHeaderList(headers) {\n  return Object.keys(headers).sort().join(\";\");\n};","map":{"version":3,"sources":["C:/Users/AHSAN PC/Desktop/digitsu/gamp/js/node_modules/@aws-sdk/signature-v4/dist-es/SignatureV4.js"],"names":["__awaiter","__generator","toHex","ALGORITHM_IDENTIFIER","ALGORITHM_QUERY_PARAM","AMZ_DATE_HEADER","AMZ_DATE_QUERY_PARAM","AUTH_HEADER","CREDENTIAL_QUERY_PARAM","EVENT_ALGORITHM_IDENTIFIER","EXPIRES_QUERY_PARAM","MAX_PRESIGNED_TTL","SHA256_HEADER","SIGNATURE_QUERY_PARAM","SIGNED_HEADERS_QUERY_PARAM","TOKEN_HEADER","TOKEN_QUERY_PARAM","createScope","getSigningKey","getCanonicalHeaders","getCanonicalQuery","getPayloadHash","hasHeader","moveHeadersToQuery","normalizeCredentialsProvider","normalizeRegionProvider","prepareRequest","iso8601","SignatureV4","_a","applyChecksum","credentials","region","service","sha256","_b","uriEscapePath","regionProvider","credentialProvider","prototype","presign","originalRequest","options","signingDate","expiresIn","unsignableHeaders","unhoistableHeaders","signableHeaders","signingRegion","signingService","_c","_d","longDate","shortDate","scope","request","canonicalHeaders","_e","_f","_g","_h","_j","_k","_l","label","Date","sent","formatDate","Promise","reject","sessionToken","query","accessKeyId","toString","getCanonicalHeaderList","getSignature","createCanonicalRequest","apply","concat","sign","toSign","signString","headers","payload","signEvent","signRequest","priorSignature","hashedPayload","hash","hashedHeaders","stringToSign","body","update","digest","join","bind","requestToSign","payloadHash","signature","sortedHeaders","Object","keys","sort","method","getCanonicalPath","map","name","createStringToSign","credentialScope","canonicalRequest","hashedRequest","path","doubleEncoded","encodeURIComponent","replace","keyPromise","now","substr"],"mappings":"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","sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { toHex } from \"@aws-sdk/util-hex-encoding\";\nimport { ALGORITHM_IDENTIFIER, ALGORITHM_QUERY_PARAM, AMZ_DATE_HEADER, AMZ_DATE_QUERY_PARAM, AUTH_HEADER, CREDENTIAL_QUERY_PARAM, EVENT_ALGORITHM_IDENTIFIER, EXPIRES_QUERY_PARAM, MAX_PRESIGNED_TTL, SHA256_HEADER, SIGNATURE_QUERY_PARAM, SIGNED_HEADERS_QUERY_PARAM, TOKEN_HEADER, TOKEN_QUERY_PARAM, } from \"./constants\";\nimport { createScope, getSigningKey } from \"./credentialDerivation\";\nimport { getCanonicalHeaders } from \"./getCanonicalHeaders\";\nimport { getCanonicalQuery } from \"./getCanonicalQuery\";\nimport { getPayloadHash } from \"./getPayloadHash\";\nimport { hasHeader } from \"./headerUtil\";\nimport { moveHeadersToQuery } from \"./moveHeadersToQuery\";\nimport { normalizeCredentialsProvider, normalizeRegionProvider } from \"./normalizeProvider\";\nimport { prepareRequest } from \"./prepareRequest\";\nimport { iso8601 } from \"./utilDate\";\nvar SignatureV4 = (function () {\n    function SignatureV4(_a) {\n        var applyChecksum = _a.applyChecksum, credentials = _a.credentials, region = _a.region, service = _a.service, sha256 = _a.sha256, _b = _a.uriEscapePath, uriEscapePath = _b === void 0 ? true : _b;\n        this.service = service;\n        this.sha256 = sha256;\n        this.uriEscapePath = uriEscapePath;\n        this.applyChecksum = typeof applyChecksum === \"boolean\" ? applyChecksum : true;\n        this.regionProvider = normalizeRegionProvider(region);\n        this.credentialProvider = normalizeCredentialsProvider(credentials);\n    }\n    SignatureV4.prototype.presign = function (originalRequest, options) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, signingDate, _b, expiresIn, unsignableHeaders, unhoistableHeaders, signableHeaders, signingRegion, signingService, credentials, region, _c, _d, longDate, shortDate, scope, request, canonicalHeaders, _e, _f, _g, _h, _j, _k;\n            return __generator(this, function (_l) {\n                switch (_l.label) {\n                    case 0:\n                        _a = options.signingDate, signingDate = _a === void 0 ? new Date() : _a, _b = options.expiresIn, expiresIn = _b === void 0 ? 3600 : _b, unsignableHeaders = options.unsignableHeaders, unhoistableHeaders = options.unhoistableHeaders, signableHeaders = options.signableHeaders, signingRegion = options.signingRegion, signingService = options.signingService;\n                        return [4, this.credentialProvider()];\n                    case 1:\n                        credentials = _l.sent();\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n                        _c = signingRegion;\n                        return [3, 4];\n                    case 2: return [4, this.regionProvider()];\n                    case 3:\n                        _c = (_l.sent());\n                        _l.label = 4;\n                    case 4:\n                        region = _c;\n                        _d = formatDate(signingDate), longDate = _d.longDate, shortDate = _d.shortDate;\n                        if (expiresIn > MAX_PRESIGNED_TTL) {\n                            return [2, Promise.reject(\"Signature version 4 presigned URLs\" + \" must have an expiration date less than one week in\" + \" the future\")];\n                        }\n                        scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n                        request = moveHeadersToQuery(prepareRequest(originalRequest), { unhoistableHeaders: unhoistableHeaders });\n                        if (credentials.sessionToken) {\n                            request.query[TOKEN_QUERY_PARAM] = credentials.sessionToken;\n                        }\n                        request.query[ALGORITHM_QUERY_PARAM] = ALGORITHM_IDENTIFIER;\n                        request.query[CREDENTIAL_QUERY_PARAM] = credentials.accessKeyId + \"/\" + scope;\n                        request.query[AMZ_DATE_QUERY_PARAM] = longDate;\n                        request.query[EXPIRES_QUERY_PARAM] = expiresIn.toString(10);\n                        canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n                        request.query[SIGNED_HEADERS_QUERY_PARAM] = getCanonicalHeaderList(canonicalHeaders);\n                        _e = request.query;\n                        _f = SIGNATURE_QUERY_PARAM;\n                        _g = this.getSignature;\n                        _h = [longDate,\n                            scope,\n                            this.getSigningKey(credentials, region, shortDate, signingService)];\n                        _j = this.createCanonicalRequest;\n                        _k = [request, canonicalHeaders];\n                        return [4, getPayloadHash(originalRequest, this.sha256)];\n                    case 5: return [4, _g.apply(this, _h.concat([_j.apply(this, _k.concat([_l.sent()]))]))];\n                    case 6:\n                        _e[_f] = _l.sent();\n                        return [2, request];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.sign = function (toSign, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (typeof toSign === \"string\") {\n                    return [2, this.signString(toSign, options)];\n                }\n                else if (toSign.headers && toSign.payload) {\n                    return [2, this.signEvent(toSign, options)];\n                }\n                else {\n                    return [2, this.signRequest(toSign, options)];\n                }\n                return [2];\n            });\n        });\n    };\n    SignatureV4.prototype.signEvent = function (_a, _b) {\n        var headers = _a.headers, payload = _a.payload;\n        var _c = _b.signingDate, signingDate = _c === void 0 ? new Date() : _c, priorSignature = _b.priorSignature, signingRegion = _b.signingRegion, signingService = _b.signingService;\n        return __awaiter(this, void 0, void 0, function () {\n            var region, _d, _e, shortDate, longDate, scope, hashedPayload, hash, hashedHeaders, _f, stringToSign;\n            return __generator(this, function (_g) {\n                switch (_g.label) {\n                    case 0:\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 1];\n                        _d = signingRegion;\n                        return [3, 3];\n                    case 1: return [4, this.regionProvider()];\n                    case 2:\n                        _d = (_g.sent());\n                        _g.label = 3;\n                    case 3:\n                        region = _d;\n                        _e = formatDate(signingDate), shortDate = _e.shortDate, longDate = _e.longDate;\n                        scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n                        return [4, getPayloadHash({ headers: {}, body: payload }, this.sha256)];\n                    case 4:\n                        hashedPayload = _g.sent();\n                        hash = new this.sha256();\n                        hash.update(headers);\n                        _f = toHex;\n                        return [4, hash.digest()];\n                    case 5:\n                        hashedHeaders = _f.apply(void 0, [_g.sent()]);\n                        stringToSign = [\n                            EVENT_ALGORITHM_IDENTIFIER,\n                            longDate,\n                            scope,\n                            priorSignature,\n                            hashedHeaders,\n                            hashedPayload,\n                        ].join(\"\\n\");\n                        return [2, this.signString(stringToSign, { signingDate: signingDate, signingRegion: region, signingService: signingService })];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.signString = function (stringToSign, _a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.signingDate, signingDate = _c === void 0 ? new Date() : _c, signingRegion = _b.signingRegion, signingService = _b.signingService;\n        return __awaiter(this, void 0, void 0, function () {\n            var credentials, region, _d, shortDate, hash, _e, _f, _g;\n            return __generator(this, function (_h) {\n                switch (_h.label) {\n                    case 0: return [4, this.credentialProvider()];\n                    case 1:\n                        credentials = _h.sent();\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n                        _d = signingRegion;\n                        return [3, 4];\n                    case 2: return [4, this.regionProvider()];\n                    case 3:\n                        _d = (_h.sent());\n                        _h.label = 4;\n                    case 4:\n                        region = _d;\n                        shortDate = formatDate(signingDate).shortDate;\n                        _f = (_e = this.sha256).bind;\n                        return [4, this.getSigningKey(credentials, region, shortDate, signingService)];\n                    case 5:\n                        hash = new (_f.apply(_e, [void 0, _h.sent()]))();\n                        hash.update(stringToSign);\n                        _g = toHex;\n                        return [4, hash.digest()];\n                    case 6: return [2, _g.apply(void 0, [_h.sent()])];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.signRequest = function (requestToSign, _a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.signingDate, signingDate = _c === void 0 ? new Date() : _c, signableHeaders = _b.signableHeaders, unsignableHeaders = _b.unsignableHeaders, signingRegion = _b.signingRegion, signingService = _b.signingService;\n        return __awaiter(this, void 0, void 0, function () {\n            var credentials, region, _d, request, _e, longDate, shortDate, scope, payloadHash, canonicalHeaders, signature;\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0: return [4, this.credentialProvider()];\n                    case 1:\n                        credentials = _f.sent();\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n                        _d = signingRegion;\n                        return [3, 4];\n                    case 2: return [4, this.regionProvider()];\n                    case 3:\n                        _d = (_f.sent());\n                        _f.label = 4;\n                    case 4:\n                        region = _d;\n                        request = prepareRequest(requestToSign);\n                        _e = formatDate(signingDate), longDate = _e.longDate, shortDate = _e.shortDate;\n                        scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n                        request.headers[AMZ_DATE_HEADER] = longDate;\n                        if (credentials.sessionToken) {\n                            request.headers[TOKEN_HEADER] = credentials.sessionToken;\n                        }\n                        return [4, getPayloadHash(request, this.sha256)];\n                    case 5:\n                        payloadHash = _f.sent();\n                        if (!hasHeader(SHA256_HEADER, request.headers) && this.applyChecksum) {\n                            request.headers[SHA256_HEADER] = payloadHash;\n                        }\n                        canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n                        return [4, this.getSignature(longDate, scope, this.getSigningKey(credentials, region, shortDate, signingService), this.createCanonicalRequest(request, canonicalHeaders, payloadHash))];\n                    case 6:\n                        signature = _f.sent();\n                        request.headers[AUTH_HEADER] =\n                            ALGORITHM_IDENTIFIER + \" \" +\n                                (\"Credential=\" + credentials.accessKeyId + \"/\" + scope + \", \") +\n                                (\"SignedHeaders=\" + getCanonicalHeaderList(canonicalHeaders) + \", \") +\n                                (\"Signature=\" + signature);\n                        return [2, request];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.createCanonicalRequest = function (request, canonicalHeaders, payloadHash) {\n        var sortedHeaders = Object.keys(canonicalHeaders).sort();\n        return request.method + \"\\n\" + this.getCanonicalPath(request) + \"\\n\" + getCanonicalQuery(request) + \"\\n\" + sortedHeaders.map(function (name) { return name + \":\" + canonicalHeaders[name]; }).join(\"\\n\") + \"\\n\\n\" + sortedHeaders.join(\";\") + \"\\n\" + payloadHash;\n    };\n    SignatureV4.prototype.createStringToSign = function (longDate, credentialScope, canonicalRequest) {\n        return __awaiter(this, void 0, void 0, function () {\n            var hash, hashedRequest;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hash = new this.sha256();\n                        hash.update(canonicalRequest);\n                        return [4, hash.digest()];\n                    case 1:\n                        hashedRequest = _a.sent();\n                        return [2, ALGORITHM_IDENTIFIER + \"\\n\" + longDate + \"\\n\" + credentialScope + \"\\n\" + toHex(hashedRequest)];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.getCanonicalPath = function (_a) {\n        var path = _a.path;\n        if (this.uriEscapePath) {\n            var doubleEncoded = encodeURIComponent(path.replace(/^\\//, \"\"));\n            return \"/\" + doubleEncoded.replace(/%2F/g, \"/\");\n        }\n        return path;\n    };\n    SignatureV4.prototype.getSignature = function (longDate, credentialScope, keyPromise, canonicalRequest) {\n        return __awaiter(this, void 0, void 0, function () {\n            var stringToSign, hash, _a, _b, _c;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0: return [4, this.createStringToSign(longDate, credentialScope, canonicalRequest)];\n                    case 1:\n                        stringToSign = _d.sent();\n                        _b = (_a = this.sha256).bind;\n                        return [4, keyPromise];\n                    case 2:\n                        hash = new (_b.apply(_a, [void 0, _d.sent()]))();\n                        hash.update(stringToSign);\n                        _c = toHex;\n                        return [4, hash.digest()];\n                    case 3: return [2, _c.apply(void 0, [_d.sent()])];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.getSigningKey = function (credentials, region, shortDate, service) {\n        return getSigningKey(this.sha256, credentials, shortDate, region, service || this.service);\n    };\n    return SignatureV4;\n}());\nexport { SignatureV4 };\nvar formatDate = function (now) {\n    var longDate = iso8601(now).replace(/[\\-:]/g, \"\");\n    return {\n        longDate: longDate,\n        shortDate: longDate.substr(0, 8),\n    };\n};\nvar getCanonicalHeaderList = function (headers) { return Object.keys(headers).sort().join(\";\"); };\n"]},"metadata":{},"sourceType":"module"}